# 🎬 Premiere Auto Edit - 使い方ガイド

動画を自動でカット・テロップ挿入し、Premiere Pro用XMLファイルを生成するツールです。

## 📋 目次

1. [基本的な使い方](#基本的な使い方)
2. [オプション詳細](#オプション詳細)
3. [出力ファイルについて](#出力ファイルについて)
4. [Premiere Proでの使い方](#premiere-proでの使い方)
5. [カスタマイズ](#カスタマイズ)
6. [トラブルシューティング](#トラブルシューティング)

---

## 基本的な使い方

### 最もシンプルな使い方

```bash
npm start my-video.mp4
```

または

```bash
node cli.js my-video.mp4
```

これだけで以下の処理が自動で行われます：

1. ✂️ **無音部分を自動カット**
2. 🗑️ **「えー」「あー」などフィラーワードを除去**
3. 📝 **音声を認識して自動テロップ生成**
4. 📦 **Premiere Pro用XMLファイルを出力**

### 処理の流れ

```
動画ファイル (.mp4/.mov など)
    ↓
【ステップ1】動画解析 (無音・シーン検出)
    ↓
【ステップ2】音声認識 (OpenAI Whisper API)
    ↓
【ステップ3】自動カット候補生成
    ↓
【ステップ4】テロップ生成
    ↓
【ステップ5】XML/EDL/JSON/CSVで出力
    ↓
output/ フォルダに4つのファイルが生成
```

---

## オプション詳細

### 出力先を指定

```bash
npm start my-video.mp4 -- --output ./編集済み
```

### 無音検出の閾値を調整

カットが多すぎる場合：
```bash
npm start my-video.mp4 -- --threshold -45
```
※ 値を大きくすると、より静かな部分だけをカット

カットが少なすぎる場合：
```bash
npm start my-video.mp4 -- --threshold -35
```
※ 値を小さくすると、より多くの部分をカット

### テロップの長さを調整

1行あたりの文字数を変更：
```bash
npm start my-video.mp4 -- --chars 25
```

### すべてのオプションを組み合わせ

```bash
npm start my-video.mp4 -- --output ./edited --threshold -38 --chars 22
```

---

## 出力ファイルについて

処理が完了すると、`output/` フォルダに4つのファイルが生成されます：

### 1. `<動画名>_project.xml` ⭐ **メインファイル**

- **Premiere Pro用のXMLプロジェクトファイル**
- カット情報とテロップがすべて含まれています
- これをPremiere Proにインポートすれば編集完了！

### 2. `<動画名>_edl.edl`

- **EDL (Edit Decision List) 形式**
- 他の編集ソフトとの互換性用
- タイムコードベースのカット情報

### 3. `<動画名>_project.json`

- **JSON形式の完全なプロジェクトデータ**
- すべての編集情報が含まれています
- プログラムから読み込んで再利用可能

### 4. `<動画名>_report.csv`

- **編集レポート（CSV）**
- Excelで開ける
- どこをカットしたか、どんなテロップを付けたかの詳細リスト

---

## Premiere Proでの使い方

### ステップ1: XMLファイルをインポート

1. **Premiere Proを開く**
2. **ファイル** → **読み込み** をクリック
3. `output/<動画名>_project.xml` を選択

### ステップ2: タイムラインに配置

1. プロジェクトパネルに「Edited Sequence」が表示されます
2. これをタイムラインにドラッグ&ドロップ

### ステップ3: 確認・微調整

自動で以下が配置されています：

- **ビデオトラック1**: カット済みの映像クリップ
- **ビデオトラック2**: テロップ（字幕）

あとは微調整するだけ！

---

## カスタマイズ

### 設定ファイルで詳細調整

`config/default.config.js` を編集することで、さらに細かい調整が可能です：

#### 無音検出の調整

```javascript
autoCut: {
  silenceThreshold: -40,      // 無音の閾値（dB）
  silenceMinDuration: 0.5,    // 無音の最小継続時間（秒）
  cutBuffer: 0.1,             // カット前後のバッファ（秒）
  minClipDuration: 1.0,       // 最小クリップ長（秒）
}
```

#### フィラーワードのカスタマイズ

```javascript
autoCut: {
  fillerWords: ['えー', 'あー', 'えっと', 'まあ', 'そうですね'],
}
```

好きな言葉を追加できます。

#### テロップスタイルの変更

```javascript
caption: {
  maxCharsPerLine: 20,        // 1行の最大文字数
  defaultStyle: {
    fontSize: 48,             // フォントサイズ
    fontFamily: 'Arial',      // フォント
    color: '#FFFFFF',         // 文字色（白）
    strokeColor: '#000000',   // 縁取り色（黒）
    strokeWidth: 3,           // 縁取りの太さ
    position: 'bottom',       // 位置 ('top', 'middle', 'bottom')
    yOffset: 100,             // 画面下端からのオフセット（px）
  },
}
```

---

## YouTubeスタイル学習（上級機能）

好きなYouTubeチャンネルの編集スタイルを学習して適用できます。

### ステップ1: スタイルを学習

```javascript
// learn-my-style.js を作成
import AutoEditPipeline from './src/core/index.js';

const pipeline = new AutoEditPipeline();

await pipeline.learnStyle([
  'https://www.youtube.com/watch?v=VIDEO_ID_1',
  'https://www.youtube.com/watch?v=VIDEO_ID_2',
  'https://www.youtube.com/watch?v=VIDEO_ID_3',
], 'my-favorite-channel');

console.log('学習完了！');
```

実行：
```bash
node learn-my-style.js
```

### ステップ2: 学習したスタイルで編集

```bash
npm start my-video.mp4 -- --style my-favorite-channel
```

---

## トラブルシューティング

### ❌ エラー: "OPENAI_API_KEY is not set"

**原因**: OpenAI APIキーが設定されていません

**解決策**:
```bash
# .env ファイルを確認
cat .env

# OPENAI_API_KEY=sk-... が設定されているか確認
```

### ❌ カットが多すぎる

**原因**: 無音検出の閾値が敏感すぎます

**解決策**: 閾値を大きくする
```bash
npm start video.mp4 -- --threshold -45
```

または `config/default.config.js` で：
```javascript
silenceThreshold: -45  // -40 から -45 に変更
```

### ❌ カットが少なすぎる

**原因**: 無音検出の閾値が鈍感すぎます

**解決策**: 閾値を小さくする
```bash
npm start video.mp4 -- --threshold -35
```

### ❌ テロップが読みにくい

**解決策**: 1行の文字数を調整
```bash
npm start video.mp4 -- --chars 15  # 短くする
npm start video.mp4 -- --chars 30  # 長くする
```

### ❌ 処理が遅い

**原因**: 動画が長い、またはWhisper APIの処理時間

**目安**:
- 5分の動画 → 約1〜2分
- 20分の動画 → 約5〜8分
- 60分の動画 → 約15〜25分

**解決策**:
- 処理は並列化されているので、待つしかありません
- Node.jsのメモリを増やす：
  ```bash
  node --max-old-space-size=4096 cli.js video.mp4
  ```

### ❌ ファイルが見つからない

**確認事項**:
1. 動画ファイルのパスが正しいか
2. ファイル名にスペースが含まれている場合は引用符で囲む
   ```bash
   npm start "my video.mp4"
   ```

---

## ヘルプコマンド

いつでもヘルプを表示できます：

```bash
npm start -- --help
```

または

```bash
node cli.js --help
```

---

## クイックリファレンス

| コマンド | 説明 |
|---------|------|
| `npm start video.mp4` | 基本的な自動編集 |
| `npm start video.mp4 -- -o ./edited` | 出力先指定 |
| `npm start video.mp4 -- -t -45` | カットを減らす |
| `npm start video.mp4 -- -t -35` | カットを増やす |
| `npm start video.mp4 -- -c 25` | テロップを長く |
| `npm start video.mp4 -- -c 15` | テロップを短く |
| `npm start -- --help` | ヘルプ表示 |

---

## 📞 サポート

問題が発生した場合：

1. **ログを確認**: `logs/app.log` でエラー詳細を確認
2. **設定を確認**: `config/default.config.js` の設定を見直す
3. **GitHub Issue**: 問題を報告

---

**Happy Editing! 🎬**
